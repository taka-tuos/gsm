# 魔改版GS Mode Selector
***AS IS***←めっちゃ重要  
# 概要
480i固定で240pの画面は伸長して480iの画面はそのまま出す感じのモードを追加してあります  (PS1 VMODESの中)  
480p固定だと480iと240pが切り替わるゲームがつらかった(240pを押しつぶすか480iをははみ出させるかになる)  
明らかに保証されないであろう挙動を利用してるので、SCPH-77000/390000以外での動作が確認できてません  
(だれか試してほしい、結果は [@taka_hvc@social.mikutter.hachune.net](https://social.mikutter.hachune.net/@taka_hvc1)か[@kagura@otogamer.me](https://otogamer.me/@kagura)、もしくはTwitterで[@taka_hvc1](https://twitter.com/taka_hvc1)まで)  
後述の原理のせいで異常なオフセットが必要です(X:-72 Y:-100～-108)  

# 自動設定モード
ELFの名前の先頭が``'V'``だと自動設定モードで起動します(以下のフォーマットに沿ってないとどう暴れるかわかりません) 

|V|aa|bb|cc|d|.ELF|備考|
|-|-|-|-|-|-|-|
|自動設定|Xオフセット|Yオフセット|モード番号|終了方法|-|16進、オフセットは00h=-127|

# 原理(手持ちのSCPH-77000/39000での話)
480iモードに固定すると**表示領域が480ライン相当であれば**240p画面は上半分に押しつぶされて表示される  
表示領域を広げると当然表示領域が画面からはみ出るが、この時描画が表示領域の真ん中にされるようになっていて画面は下にずれていく  
で、この時**何故か240pの画面が伸長される**、しかも何故か**画面高さが1.5倍(480+240=720ライン相当)の時にちょうど480ラインに伸長される**(この挙動がどう考えてもほかの型番で保障されると思えない)  
伸長された240p画面と480i画面の上端は常に同じ位置にあるので、この状態で思いっきりオフセットを下にずらすと480iに統一した画面表示ができる  

# 主なユースケース
アプコンのない安価なPS2-HDMI変換器を使っていて、つながっているモニターが240p非対応な場合  

# ビルドに関して
公式が配ってる[2018年版msys環境](https://github.com/ps2dev/ps2toolchain/releases/tag/2018-10-19)じゃないとコンパイルできませんでした(Linuxの人は…頑張って…)  
僕はwslでコンパイルするために↑の配布からps2dev部分を引っこ抜いて頑張りました  
以下はわかる人&自分向け雑なまとめ  
1. Wineを入れる(binfmtも忘れずに)  
1. ps2dev部分を引っこ抜いて適当な場所に置く
1. MinGW/bin/のDLLをWine上でPATHが通ってるところ(僕は~/.wine/drive_cにフォルダ生やしてregeditでPATH足しました)に置く
1. ``find ps2dev/ -name *.exe | rev | cut -f 2- -d "." | rev | xargs -n1 readlink -f | xargs -I{} ln -s {}.exe {}``
1. ドキュメントを見て(Linux側の)環境変数を設定する($PS2DEVなど)

# 検証済みソフト
|タイトル|解像度|プラットフォーム|Yオフセット|ロード方法|本体|動作可否|備考|検証者|
|-|-|-|-|-|-|-|-|-|
|beatmania IIDX 6th Style|240p|PS2|-100|ESR|SCPH-77000/39000|⚠|音ズレ(オリジナルのGSMでも発生)|kagura1050|
|beatmania 2ndMIX|240p|PS1|-108|実ディスク/POPSTARTER SMB|SCPH-77000/39000|✅|なし|kagura1050| 
|ACE COMBAT 3 electrosphere|480i/240p|PS1|-108|実ディスク/POPSTARTER SMB|SCPH-77000/39000|✅|なし|kagura1050|  
